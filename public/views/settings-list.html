<div class="settings">


  <ul class="list-group body" ng-controller="UsersController as uC" ng-show="nC.user.can('user.view.all')">

    <!-- header unit -->
    <li class="list-group-item">
      <h3>
        <span class="glyphicon glyphicon-user"></span>
        Users
      </h3>
      <p>
        Each user listed below can login to Que - to see or edit what each user
        can do, click 'Edit Permissions' below.
      </p>
    </li>


    <li class="list-group-item" ng-repeat="user in uC.users">
      <h3>{{user.username}}</h3>

      <button class="btn btn-danger pull-right">Delete</button>
      <button class="btn btn-primary pull-right" data-toggle="modal" data-target="#user-editpermissions-{{user.username}}">Edit Permissions</button>
      <button class="btn btn-default pull-right">Change Password</button>

      <!-- permissions editor -->
      <div class="modal fade editpermissions-modal" id="user-editpermissions-{{user.username}}" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
        <div class="modal-dialog">
          <div class="modal-content">
            <div class="modal-header">
              <button type="button" class="close" data-dismiss="modal"><span aria-hidden="true">&times;</span><span class="sr-only">Close</span></button>
              <h4 class="modal-title" id="myModalLabel">Edit Permissions</h4>
            </div>
            <div class="modal-body">

              <div class="row">
                <input type="text" placeholder="Add Permission" ng-model="uC.newPermission"/>
                <button class="add-btn" ng-click="uC.addPermission(user.username, uC.newPermission)">Add</button>

                <!-- permission list -->
                <ul class="scrollable">
                  <li ng-repeat="p in user.permissions">
                    <!-- display permission -->
                    <span class="permission {{p.split('.')[0]}}">{{p.split('.')[0]}}</span>
                    <span ng-show="p.split('.').length > 1">.</span>
                    <span>{{p.split('.').slice(1).join('.')}}</span>

                    <!-- delete button -->
                    <button class="btn btn-danger btn-xs" ng-click="uC.deletePermission(user.username, $index)">Delete</button>
                  </li>
                </ul>
              </div>

            </div>
            <div class="modal-footer">
              <button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
              <button type="button" class="btn btn-primary">Save</button>
            </div>
          </div>
        </div>
      </div>


    </li>
  </ul>

  <section class="body" ng-controller="KeysController as kC" ng-show="nC.user.can('token.view')">
    <h3>
      <span class="glyphicon glyphicon-lock"></span>
      Keys
    </h3>
    <p>
      These keys are needed for 3rd party services (like the spark) to work.
    </p>
    <ul>
      <li>
        <label>Spark Key</label>
        <p>
          Go to <a href="//www.spark.io/build">http://www.spark.io/build</a>.
          Login with your spark account. Click the cog in the lower left corner of the screen
          and copy the text in the box under "Access Token". Enter this into the box below.
        </p>
        <div class="input-group together">
          <input
            type="text"
            class="form-control spark-key"
            placeholder="Spark Key"
            ng-model="kC.keys.sparktoken"
            ng-change="kC.updateKeys()"
            ng-disabled="!nC.user.can('token.edit')"
          />
          <span class="input-group-addon validated">
            <span class="glyphicon glyphicon-ok" ng-show="kC.validated.sparktoken"></span>
            <span class="glyphicon glyphicon-remove" ng-hide="kC.validated.sparktoken"></span>
          </span>
        </div>
      </li>
    </ul>
  </section>

</div>
